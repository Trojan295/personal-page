<!DOCTYPE html>
<html lang="en" class="direction-ltr">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<title>Using AWS SAM and CodeDeploy to deploy serverless applications - myhightech.org</title>

<meta name="description" content="AWS Serverless Application Model I was recently preparing for my AWS DevOps Engineer exam and I wanted to give AWS Serverless Application Model a try. AWS Serverless Application Model is a framework to build and deploy serverless application on AWS using Lambda, API Gateway and DynamoDB.
Under the hood it is a AWS CloudFormation transform, which expands the CloudFormation syntax and adds additional resources under the AWS::Serverless namespace. During the template provisioning those resources get expanded to basic CloudFormation resources.">
<meta name="keywords" content= />
<meta name="author" content="">
<link rel="canonical" href="/posts/aws-sam-codedeploy/" />
<link href="/assets/css/stylesheet.min.87066ffbb2170258c470f7afccdae0416379fd09fb46cb2bcff638a8a677075a.css" integrity="sha256-hwZv&#43;7IXAljEcPevzNrgQWN5/Qn7Rssrz/Y4qKZ3B1o=" rel="preload stylesheet"
    as="style">
<script src="/js/Chart.bundle.min.js"></script>

<link rel="apple-touch-icon" href="%20apple-touch-icon.png">
<link rel="icon" href="%20favicon.ico">
<meta name="generator" content="Hugo 0.82.0" />



</head>

<body class="single" id="top">
<script>
    
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark');
        }
    }

</script>
<noscript>
    <style type="text/css">
        .theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="">myhightech.org</a>
            <span class="logo-switches">
                <span class="theme-toggle">
                    <a id="theme-toggle">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </a>
                </span>
                
            </span>
        </div>
        <ul class="menu" id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="/posts/">
                    <span>
                        Blog
                    </span>
                </a>
            </li>
            <li>
                <a href="/categories/">
                    <span>
                        Categories
                    </span>
                </a>
            </li>
            <li>
                <a href="/about/">
                    <span>
                        About me
                    </span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">
      Using AWS SAM and CodeDeploy to deploy serverless applications
    </h1>
    <div class="post-meta">September 18, 2020&nbsp;·&nbsp;8 min

    </div>
  </header> 

  <div class="post-content"><h2 id="aws-serverless-application-model">AWS Serverless Application Model</h2>
<p>I was recently preparing for my AWS DevOps Engineer exam and I wanted to give AWS Serverless Application Model a try. AWS Serverless Application Model is a framework to build and deploy serverless application on AWS using Lambda, API Gateway and DynamoDB.</p>
<p>Under the hood it is a AWS CloudFormation transform, which expands the CloudFormation syntax and adds additional resources under the <code>AWS::Serverless</code> namespace. During the template provisioning those resources get expanded to basic CloudFormation resources.</p>
<p>The <code>sam</code> CLI has commands to build, test, package and deploy your serverless applications. It makes deploying serverless application much easier than packaging your application by yourself and using generic CloudFormation templates.</p>
<h2 id="initialize-the-project">Initialize the project</h2>
<p>To initialize the project you use the <code>sam init</code> command. It will ask a few questions and prepare a boilerplate project.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sam init 
Which template source would you like to use?
        <span style="color:#ae81ff">1</span> - AWS Quick Start Templates
        <span style="color:#ae81ff">2</span> - Custom Template Location
Choice: <span style="color:#ae81ff">1</span>

Which runtime would you like to use?
        <span style="color:#ae81ff">1</span> - nodejs12.x
        <span style="color:#ae81ff">2</span> - python3.8
        <span style="color:#ae81ff">3</span> - ruby2.7
        <span style="color:#ae81ff">4</span> - go1.x
        <span style="color:#ae81ff">5</span> - java11
        <span style="color:#ae81ff">6</span> - dotnetcore3.1
        <span style="color:#ae81ff">7</span> - nodejs10.x
        <span style="color:#ae81ff">8</span> - python3.7
        <span style="color:#ae81ff">9</span> - python3.6
        <span style="color:#ae81ff">10</span> - python2.7
        <span style="color:#ae81ff">11</span> - ruby2.5
        <span style="color:#ae81ff">12</span> - java8.al2
        <span style="color:#ae81ff">13</span> - java8
        <span style="color:#ae81ff">14</span> - dotnetcore2.1
Runtime: <span style="color:#ae81ff">4</span>

Project name <span style="color:#f92672">[</span>sam-app<span style="color:#f92672">]</span>: 

Cloning app templates from https://github.com/awslabs/aws-sam-cli-app-templates.git

AWS quick start application templates:
        <span style="color:#ae81ff">1</span> - Hello World Example
        <span style="color:#ae81ff">2</span> - Step Functions Sample App <span style="color:#f92672">(</span>Stock Trader<span style="color:#f92672">)</span>
Template selection: <span style="color:#ae81ff">1</span>

-----------------------
Generating application:
-----------------------
Name: sam-app
Runtime: go1.x
Dependency Manager: mod
Application Template: hello-world
Output Directory: .

Next steps can be found in the README file at ./sam-app/README.md
$ tree
.
├── Makefile
├── README.md
├── hello-world
│   ├── go.mod
│   ├── main.go
│   └── main_test.go
└── template.yaml

<span style="color:#ae81ff">1</span> directory, <span style="color:#ae81ff">6</span> files</code></pre></div>
<p>The project has a CloudFormation template in <code>template.yaml</code> and an example Lambda function handler in <code>hello-world/main.go</code>. You can notice the <code>Transform: AWS::Serverless-2016-10-31</code> field in the template, which means we are using AWS SAM:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="display:block;width:100%;background-color:#3c3d38"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">AWSTemplateFormatVersion</span>: <span style="color:#e6db74">&#39;2010-09-09&#39;</span>
<span style="display:block;width:100%;background-color:#3c3d38"><span style="color:#f92672">Transform</span>: <span style="color:#ae81ff">AWS::Serverless-2016-10-31</span>
</span>
[<span style="color:#ae81ff">...]</span>

<span style="color:#f92672">Resources</span>:
  <span style="color:#f92672">HelloWorldFunction</span>:
    <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">AWS::Serverless::Function</span>
    <span style="color:#f92672">Properties</span>:
      <span style="color:#f92672">CodeUri</span>: <span style="color:#ae81ff">hello-world/</span>
      <span style="color:#f92672">Handler</span>: <span style="color:#ae81ff">hello-world</span>
      <span style="color:#f92672">Runtime</span>: <span style="color:#ae81ff">go1.x</span>
      <span style="color:#f92672">Tracing</span>: <span style="color:#ae81ff">Active</span>
      <span style="color:#f92672">Events</span>:
        <span style="color:#f92672">CatchAll</span>:
          <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">Api</span>
          <span style="color:#f92672">Properties</span>:
            <span style="color:#f92672">Path</span>: <span style="color:#ae81ff">/hello</span>
            <span style="color:#f92672">Method</span>: <span style="color:#ae81ff">GET</span>
      <span style="color:#f92672">Environment</span>:
        <span style="color:#f92672">Variables</span>:
          <span style="color:#f92672">PARAM1</span>: <span style="color:#ae81ff">VALUE</span>

[<span style="color:#ae81ff">...]</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="local-development">Local development</h2>
<p>Now to build the Lambda deployment packages run <code>sam build</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sam build 
Building <span style="color:#66d9ef">function</span> <span style="color:#e6db74">&#39;HelloWorldFunction&#39;</span>
Running GoModulesBuilder:Build

Build Succeeded

Built Artifacts  : .aws-sam/build
Built Template   : .aws-sam/build/template.yaml

Commands you can use next
<span style="color:#f92672">=========================</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Invoke Function: sam local invoke
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Deploy: sam deploy --guided</code></pre></div>
<p>A nice feature of SAM CLI is that you can run the Lambda function locally or even run a server, which simulates whole API in the template. For this you will need to have Docker installed.</p>
<p>To invoke a single function use <code>sam local invoke &lt;function-name&gt;</code>:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sam local invoke HelloWorldFunction
Invoking hello-world <span style="color:#f92672">(</span>go1.x<span style="color:#f92672">)</span>
Failed to download a new amazon/aws-sam-cli-emulation-image-go1.x:rapid-1.1.0 image. Invoking with the already downloaded image.
Mounting /home/damian/Projects/sam-test/sam-app/.aws-sam/build/HelloWorldFunction as /var/task:ro,delegated inside runtime container
START RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb Version: $LATEST
END RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb
REPORT RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb  Init Duration: 49.63 ms Duration: 549.73 ms     Billed Duration: <span style="color:#ae81ff">600</span> ms Memory Size: <span style="color:#ae81ff">128</span> MB     Max Memory Used: <span style="color:#ae81ff">51</span> MB

<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;statusCode&#34;</span>:200,<span style="color:#e6db74">&#34;headers&#34;</span>:null,<span style="color:#e6db74">&#34;multiValueHeaders&#34;</span>:null,<span style="color:#e6db74">&#34;body&#34;</span>:<span style="color:#e6db74">&#34;Hello, 178.43.131.97\n&#34;</span><span style="color:#f92672">}</span></code></pre></div></p>
<p>You can also start a server, which simulates the AWS API Gateway:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sam local start-api                
Mounting HelloWorldFunction at http://127.0.0.1:3000/hello <span style="color:#f92672">[</span>GET<span style="color:#f92672">]</span>
You can now browse to the above endpoints to invoke your functions. You <span style="color:#66d9ef">do</span> not need to restart/reload SAM CLI <span style="color:#66d9ef">while</span> working on your functions, changes will be reflected instantly/automatically. You only need to restart SAM CLI <span style="color:#66d9ef">if</span> you update your AWS SAM template
2020-09-17 17:54:42  * Running on http://127.0.0.1:3000/ <span style="color:#f92672">(</span>Press CTRL+C to quit<span style="color:#f92672">)</span>

<span style="color:#75715e"># in other terminal</span>
$ curl http://127.0.0.1:3000/hello                                      
Hello, 178.43.131.97</code></pre></div></p>
<h2 id="deploy-the-application">Deploy the application</h2>
<p>To deploy Lambda functions you need to package and upload your code to S3. AWS SAM will handle this for you, but it requires an additonal configuration file <code>samconfig.toml</code> to know what bucket it should use.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-toml" data-lang="toml"><span style="color:#75715e"># samconfig.toml</span>
<span style="color:#a6e22e">version</span> = <span style="color:#ae81ff">0.1</span>
[<span style="color:#a6e22e">default</span>]
[<span style="color:#a6e22e">default</span>.<span style="color:#a6e22e">deploy</span>]
[<span style="color:#a6e22e">default</span>.<span style="color:#a6e22e">deploy</span>.<span style="color:#a6e22e">parameters</span>]
<span style="color:#a6e22e">stack_name</span> = <span style="color:#e6db74">&#34;sam-app&#34;</span>
<span style="color:#a6e22e">s3_bucket</span> = <span style="color:#e6db74">&#34;aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy&#34;</span>
<span style="color:#a6e22e">s3_prefix</span> = <span style="color:#e6db74">&#34;sam-app&#34;</span>
<span style="color:#a6e22e">region</span> = <span style="color:#e6db74">&#34;eu-west-1&#34;</span>
<span style="color:#a6e22e">confirm_changeset</span> = <span style="color:#66d9ef">true</span>
<span style="color:#a6e22e">capabilities</span> = <span style="color:#e6db74">&#34;CAPABILITY_IAM&#34;</span></code></pre></td></tr></table>
</div>
</div>
<p>You can either provision the S3 bucket and create the <code>samconfig.toml</code> file manually or use the <code>--guided</code> flag in the <code>sam deploy</code> command, so SAM will create it for you.</p>
<p>What <code>sam deploy</code> does is:</p>
<ol>
<li>Detect, which functions must be updated</li>
<li>Upload the CloudFormation template and Lambda deployment packages to S3</li>
<li>Generate the ChangeSet and deploy it</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sam deploy --guided

Configuring SAM deploy
<span style="color:#f92672">======================</span>

        Looking <span style="color:#66d9ef">for</span> samconfig.toml :  Not found

        Setting default arguments <span style="color:#66d9ef">for</span> <span style="color:#e6db74">&#39;sam deploy&#39;</span>
        <span style="color:#f92672">=========================================</span>
        Stack Name <span style="color:#f92672">[</span>sam-app<span style="color:#f92672">]</span>: 
        AWS Region <span style="color:#f92672">[</span>us-east-1<span style="color:#f92672">]</span>: eu-west-1
        <span style="color:#75715e">#Shows you resources changes to be deployed and require a &#39;Y&#39; to initiate deploy</span>
        Confirm changes before deploy <span style="color:#f92672">[</span>y/N<span style="color:#f92672">]</span>: y
        <span style="color:#75715e">#SAM needs permission to be able to create roles to connect to the resources in your template</span>
        Allow SAM CLI IAM role creation <span style="color:#f92672">[</span>Y/n<span style="color:#f92672">]</span>: Y
        HelloWorldFunction may not have authorization defined, Is this okay? <span style="color:#f92672">[</span>y/N<span style="color:#f92672">]</span>: y
        Save arguments to samconfig.toml <span style="color:#f92672">[</span>Y/n<span style="color:#f92672">]</span>: 

        Looking <span style="color:#66d9ef">for</span> resources needed <span style="color:#66d9ef">for</span> deployment: Not found.
        Creating the required resources...
        Successfully created!

                Managed S3 bucket: aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy
                A different default S3 bucket can be set in samconfig.toml

        Saved arguments to config file
        Running <span style="color:#e6db74">&#39;sam deploy&#39;</span> <span style="color:#66d9ef">for</span> future deployments will use the parameters saved above.
        The above parameters can be changed by modifying samconfig.toml
        Learn more about samconfig.toml syntax at 
        https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-config.html
Uploading to sam-app/4a708650ed51c1f21e152bcc6440cf00  <span style="color:#ae81ff">1325</span> / 1325.0  <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span>

        Deploying with following values
        <span style="color:#f92672">===============================</span>
        Stack name                 : sam-app
        Region                     : eu-west-1
        Confirm changeset          : True
        Deployment s3 bucket       : aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy
        Capabilities               : <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;CAPABILITY_IAM&#34;</span><span style="color:#f92672">]</span>
        Parameter overrides        : <span style="color:#f92672">{}</span>

Initiating deployment
<span style="color:#f92672">=====================</span>
HelloWorldFunction may not have authorization defined.
Uploading to sam-app/cbc7be7eaba81f76b3cd7e012f847498.template  <span style="color:#ae81ff">1155</span> / 1155.0  <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span>

Waiting <span style="color:#66d9ef">for</span> changeset to be created..

CloudFormation stack changeset
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Operation                                                         LogicalResourceId                                                 ResourceType                                                    
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
+ Add                                                             HelloWorldFunctionCatchAllPermissionProd                          AWS::Lambda::Permission                                         
+ Add                                                             HelloWorldFunctionRole                                            AWS::IAM::Role                                                  
+ Add                                                             HelloWorldFunction                                                AWS::Lambda::Function                                           
+ Add                                                             ServerlessRestApiDeployment47fc2d5f9d                             AWS::ApiGateway::Deployment                                     
+ Add                                                             ServerlessRestApiProdStage                                        AWS::ApiGateway::Stage                                          
+ Add                                                             ServerlessRestApi                                                 AWS::ApiGateway::RestApi                                        
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Changeset created successfully. arn:aws:cloudformation:eu-west-1:146986152083:changeSet/samcli-deploy1600354796/6dc83be8-7e11-48c9-b6b0-8df847a66ac8


Previewing CloudFormation changeset before deployment
<span style="color:#f92672">======================================================</span>
Deploy this changeset? <span style="color:#f92672">[</span>y/N<span style="color:#f92672">]</span>: y

2020-09-17 17:00:07 - Waiting <span style="color:#66d9ef">for</span> stack create/update to complete

CloudFormation events from changeset
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ResourceStatus                                   ResourceType                                     LogicalResourceId                                ResourceStatusReason                           
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE_IN_PROGRESS                               AWS::IAM::Role                                   HelloWorldFunctionRole                           -                                              
CREATE_IN_PROGRESS                               AWS::IAM::Role                                   HelloWorldFunctionRole                           Resource creation Initiated                    
CREATE_COMPLETE                                  AWS::IAM::Role                                   HelloWorldFunctionRole                           -                                              
CREATE_IN_PROGRESS                               AWS::Lambda::Function                            HelloWorldFunction                               -                                              
CREATE_COMPLETE                                  AWS::Lambda::Function                            HelloWorldFunction                               -                                              
CREATE_IN_PROGRESS                               AWS::Lambda::Function                            HelloWorldFunction                               Resource creation Initiated                    
CREATE_IN_PROGRESS                               AWS::ApiGateway::RestApi                         ServerlessRestApi                                -                                              
CREATE_COMPLETE                                  AWS::ApiGateway::RestApi                         ServerlessRestApi                                -                                              
CREATE_IN_PROGRESS                               AWS::ApiGateway::RestApi                         ServerlessRestApi                                Resource creation Initiated                    
CREATE_IN_PROGRESS                               AWS::ApiGateway::Deployment                      ServerlessRestApiDeployment47fc2d5f9d            -                                              
CREATE_IN_PROGRESS                               AWS::Lambda::Permission                          HelloWorldFunctionCatchAllPermissionProd         Resource creation Initiated                    
CREATE_IN_PROGRESS                               AWS::Lambda::Permission                          HelloWorldFunctionCatchAllPermissionProd         -                                              
CREATE_COMPLETE                                  AWS::ApiGateway::Deployment                      ServerlessRestApiDeployment47fc2d5f9d            -                                              
CREATE_IN_PROGRESS                               AWS::ApiGateway::Deployment                      ServerlessRestApiDeployment47fc2d5f9d            Resource creation Initiated                    
CREATE_IN_PROGRESS                               AWS::ApiGateway::Stage                           ServerlessRestApiProdStage                       -                                              
CREATE_IN_PROGRESS                               AWS::ApiGateway::Stage                           ServerlessRestApiProdStage                       Resource creation Initiated                    
CREATE_COMPLETE                                  AWS::ApiGateway::Stage                           ServerlessRestApiProdStage                       -                                              
CREATE_COMPLETE                                  AWS::Lambda::Permission                          HelloWorldFunctionCatchAllPermissionProd         -                                              
CREATE_COMPLETE                                  AWS::CloudFormation::Stack                       sam-app                                          -                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CloudFormation outputs from deployed stack
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Outputs                                                                                                                                                                                           
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Key                 HelloWorldFunctionIamRole                                                                                                                                                     
Description         Implicit IAM Role created <span style="color:#66d9ef">for</span> Hello World <span style="color:#66d9ef">function</span>                                                                                                                            
Value               arn:aws:iam::146986152083:role/sam-app-HelloWorldFunctionRole-URQ6NEJVAE9X                                                                                                    

Key                 HelloWorldAPI                                                                                                                                                                 
Description         API Gateway endpoint URL <span style="color:#66d9ef">for</span> Prod environment <span style="color:#66d9ef">for</span> First Function                                                                                                              
Value               https://xzv8lq1611.execute-api.eu-west-1.amazonaws.com/Prod/hello/                                                                                                            

Key                 HelloWorldFunction                                                                                                                                                            
Description         First Lambda Function ARN                                                                                                                                                     
Value               arn:aws:lambda:eu-west-1:146986152083:function:sam-app-HelloWorldFunction-DMK403RR7HEW                                                                                        
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Successfully created/updated stack - sam-app in eu-west-1</code></pre></div>
<figure><a href="/images/aws-sam-codedeploy/aws_sam_cf_stacks.png" target="_blank">
    <img src="/images/aws-sam-codedeploy/aws_sam_cf_stacks.png"
         alt="SAM created the following CloudFormation stacks. aws-sam-cli-managed-default stack was created, because we used --guided and SAM provisioned the missing S3 bucket. sam-app stack is the actual serverless application"/> </a><figcaption>
            <p>SAM created the following CloudFormation stacks. <code>aws-sam-cli-managed-default</code> stack was created, because we used <code>--guided</code> and SAM provisioned the missing S3 bucket. <code>sam-app</code> stack is the actual serverless application</p>
        </figcaption>
</figure>

<figure><a href="/images/aws-sam-codedeploy/aws_sam_stack_resources.png" target="_blank">
    <img src="/images/aws-sam-codedeploy/aws_sam_stack_resources.png"
         alt="The AWS::Serverless::* resources were transformed into other CloudFormation resources. SAM also implicitly created an API Gateway for us"/> </a><figcaption>
            <p>The <code>AWS::Serverless::*</code> resources were transformed into other CloudFormation resources. SAM also implicitly created an API Gateway for us</p>
        </figcaption>
</figure>

<h2 id="enhance-the-template-and-add-canary-deployment">Enhance the template and add canary deployment</h2>
<p>The nice thing in AWS SAM is, that it&rsquo;s just an extension of CloudFormation templates, so you can define other resources, export output values or reference values in other stacks. It also gives an option to define the deployment strategy for Lambda functions and set triggers for rollbacks. You can perform canary deployment on the AWS Lambda level by using Lambda aliases. Let&rsquo;s change the HelloWorld function, add <code>DeploymentPreference</code> and <code>AutoPublishAlias</code> parameters and define all CloudWatch alarm to rollback the deployment in case your function does not work during the CodeDeploy <code>AllowTraffic</code> phase.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># template.yaml</span>
[<span style="color:#ae81ff">...]</span>
<span style="color:#f92672">Resources</span>:
  <span style="color:#f92672">HelloWorldServerErrorAlarm</span>:
    <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">AWS::CloudWatch::Alarm</span>
    <span style="color:#f92672">Properties</span>:
      <span style="color:#f92672">AlarmName</span>: <span style="color:#ae81ff">HelloWorldServerErrorAlarm</span>
      <span style="color:#f92672">EvaluationPeriods</span>: <span style="color:#ae81ff">1</span>
      <span style="color:#f92672">Metrics</span>:
      - <span style="color:#f92672">Id</span>: <span style="color:#ae81ff">m1</span>
        <span style="color:#f92672">MetricStat</span>:
          <span style="color:#f92672">Metric</span>:
            <span style="color:#f92672">Dimensions</span>:
              - <span style="color:#f92672">Name</span>: <span style="color:#ae81ff">FunctionName</span>
                <span style="color:#f92672">Value</span>: !<span style="color:#ae81ff">Ref HelloWorldFunction</span>
            <span style="color:#f92672">MetricName</span>: <span style="color:#ae81ff">Errors</span>
            <span style="color:#f92672">Namespace</span>: <span style="color:#ae81ff">AWS/Lambda</span>
          <span style="color:#f92672">Period</span>: <span style="color:#75715e">!!int</span> <span style="color:#ae81ff">60</span>
          <span style="color:#f92672">Stat</span>: <span style="color:#ae81ff">Average</span>
      <span style="color:#f92672">ComparisonOperator</span>: <span style="color:#ae81ff">GreaterThanThreshold</span>
      <span style="color:#f92672">Threshold</span>: <span style="color:#ae81ff">0.05</span>
      <span style="color:#f92672">TreatMissingData</span>: <span style="color:#ae81ff">notBreaching</span>

  <span style="color:#f92672">HelloWorldFunction</span>:
    <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">AWS::Serverless::Function</span>
    <span style="color:#f92672">Properties</span>:
      <span style="color:#f92672">CodeUri</span>: <span style="color:#ae81ff">hello-world/</span>
      <span style="color:#f92672">Handler</span>: <span style="color:#ae81ff">hello-world</span>
      <span style="color:#f92672">Runtime</span>: <span style="color:#ae81ff">go1.x</span>
      <span style="color:#f92672">Tracing</span>: <span style="color:#ae81ff">Active</span>
      <span style="color:#f92672">AutoPublishAlias</span>: <span style="color:#ae81ff">live</span>
      <span style="color:#f92672">DeploymentPreference</span>:
        <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">Canary10Percent5Minutes</span>
        <span style="color:#f92672">Alarms</span>:
          - !<span style="color:#ae81ff">Ref HelloWorldServerErrorAlarm</span>
      <span style="color:#f92672">Events</span>:
        <span style="color:#f92672">CatchAll</span>:
          <span style="color:#f92672">Type</span>: <span style="color:#ae81ff">Api</span>
          <span style="color:#f92672">Properties</span>:
            <span style="color:#f92672">Path</span>: <span style="color:#ae81ff">/hello</span>
            <span style="color:#f92672">Method</span>: <span style="color:#ae81ff">GET</span>
[<span style="color:#ae81ff">...]</span></code></pre></td></tr></table>
</div>
</div>
<figure><a href="/images/aws-sam-codedeploy/sam-codedeploy.png" target="_blank">
    <img src="/images/aws-sam-codedeploy/sam-codedeploy.png"
         alt="After defining DeploymentPreference SAM creates an CodeDeploy application with a deployment group for every Lambda function. sam deploy will upload the Lambda deployment packages to S3 and trigger an CodeDeploy deployment to release the new Lambda function version"/> </a><figcaption>
            <p>After defining <code>DeploymentPreference</code> SAM creates an CodeDeploy application with a deployment group for every Lambda function. <code>sam deploy</code> will upload the Lambda deployment packages to S3 and trigger an CodeDeploy deployment to release the new Lambda function version</p>
        </figcaption>
</figure>

<p>Now, let&rsquo;s make a small change in the source code, rebuild the package and deploy it. This can take a bit, cause the command waits, till the CodeDeploy deployment is finished:</p>
<pre><code>$ sam build
...
$ sam deploy
...
Successfully created/updated stack - sam-app in eu-west-1
</code></pre><figure><a href="/images/aws-sam-codedeploy/sam-codedeploy-deployment.png" target="_blank">
    <img src="/images/aws-sam-codedeploy/sam-codedeploy-deployment.png"
         alt="During the sam deploy a CodeDeploy deployment is triggered"/> </a><figcaption>
            <p>During the <code>sam deploy</code> a CodeDeploy deployment is triggered</p>
        </figcaption>
</figure>

<figure><a href="/images/aws-sam-codedeploy/sam-codedeploy-lambda.png" target="_blank">
    <img src="/images/aws-sam-codedeploy/sam-codedeploy-lambda.png"
         alt="CodeDeploy performs the canary release using an Lambda alias. Here we can see, that 10% of the requests are directed to the 4 version of the Lambda, while the rest goes to version 3"/> </a><figcaption>
            <p>CodeDeploy performs the canary release using an Lambda alias. Here we can see, that 10% of the requests are directed to the 4 version of the Lambda, while the rest goes to version 3</p>
        </figcaption>
</figure>

<h2 id="more-advanced-example">More advanced example</h2>
<p>A more advanced example is available on my Github <a href="https://github.com/Trojan295/aws-dev-ops-preparation/tree/master/lambda-sam/backend">aws-dev-ops-preparation repo</a>. It shows also how to use and implement an <a href="https://github.com/Trojan295/aws-dev-ops-preparation/blob/master/lambda-sam/backend/notes/handlers/validateApi/main.go">lifecycle hook function</a> to validate the deployment.</p>
<h2 id="additional-notes-about-sam">Additional notes about SAM</h2>
<p>A few things I would like to mention, because I lost a few hours by not knowing them:</p>
<ul>
<li>Hook functions must start with prefix <code>CodeDeployHook_</code> or you have to provide an custom IAM role for the CodeDeploy in DeploymentPreference</li>
<li>The hook functions must call the AWS API <code>codedeploy:PutLifecycleEventHookExecutionStatus</code> to inform CodeDeploy, if the hook passed or failed. In other case it will wait for 1 hour and fail</li>
<li>The Alarms in DeploymentPreference can be used to rollback the deployment on Cloudwatch Alarm. The AWS docs suggest the other way - that they are triggered by a failed deployment</li>
</ul>
<h2 id="read-more">Read more</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html">AWS SAM documentation</a></li>
<li><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-resources-and-properties.html">AWS SAM CloudFormation resources specification</a></li>
<li><a href="https://docs.aws.amazon.com/codedeploy/index.html">AWS CodeDeploy documentation</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-aliases.html">AWS Lambda aliases</a></li>
</ul>
</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="tags/aws">aws</a></li>
      <li><a href="tags/serverless">serverless</a></li>
      <li><a href="tags/lambda">lambda</a></li>
      <li><a href="tags/devops">devops</a></li>
      <li><a href="tags/codedeploy">codedeploy</a></li>
      <li><a href="tags/serverless-application-model">serverless application model</a></li>
      <li><a href="tags/sam">sam</a></li>
    </ul>






<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on twitter"
        href="https://twitter.com/intent/tweet/?text=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications&amp;url=%2fposts%2faws-sam-codedeploy%2f&amp;hashtags=aws%2cserverless%2clambda%2cdevops%2ccodedeploy%2cserverlessapplicationmodel%2csam">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fposts%2faws-sam-codedeploy%2f&amp;title=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications&amp;summary=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications&amp;source=%2fposts%2faws-sam-codedeploy%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on reddit"
        href="https://reddit.com/submit?url=%2fposts%2faws-sam-codedeploy%2f&title=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on facebook"
        href="https://facebook.com/sharer/sharer.php?u=%2fposts%2faws-sam-codedeploy%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on whatsapp"
        href="https://api.whatsapp.com/send?text=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications%20-%20%2fposts%2faws-sam-codedeploy%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on telegram"
        href="https://telegram.me/share/url?text=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications&amp;url=%2fposts%2faws-sam-codedeploy%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer><div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "myhightech-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</article>
    </main><footer class="footer">
    <span>&copy; 2021 <a href="">myhightech.org</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo️️</a>️</span>
    <span>&middot;</span>
    <span>Theme️ <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top">
    <button class="top-link" id="top-link" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6">
            <path d="M12 6H0l6-6z" /></svg>
    </button>
</a>


<script src="/assets/js/highlight.min.727bc06f35142445e1ca4dbf0c258372d440dfd30ea831e99dbe7bf9e54d11da.js" integrity="sha256-cnvAbzUUJEXhyk2/DCWDctRA39MOqDHpnb57&#43;eVNEdo="></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();

            document.querySelector(this.getAttribute("href")).scrollIntoView({
                behavior: "smooth"
            });
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })
</script>

</body>

</html>