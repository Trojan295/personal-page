<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Using AWS SAM and CodeDeploy to deploy serverless applications | myhightech.org</title>
<meta name=keywords content="aws,serverless,lambda,devops,codedeploy,serverless application model,sam">
<meta name=description content="AWS Serverless Application Model I was recently preparing for my AWS DevOps Engineer exam and I wanted to give AWS Serverless Application Model a try. AWS Serverless Application Model is a framework to build and deploy serverless application on AWS using Lambda, API Gateway and DynamoDB.
Under the hood it is a AWS CloudFormation transform, which expands the CloudFormation syntax and adds additional resources under the AWS::Serverless namespace. During the template provisioning those resources get expanded to basic CloudFormation resources.">
<meta name=author content>
<link rel=canonical href=https://myhightech.org/posts/aws-sam-codedeploy/>
<link href=/assets/css/stylesheet.min.2f1d1532323fdd4bcf6378d93a8930530619e0bba93019043bd8378671faf049.css integrity="sha256-Lx0VMjI/3UvPY3jZOokwUwYZ4LupMBkEO9g3hnH68Ek=" rel="preload stylesheet" as=style>
<link rel=icon href=https://myhightech.org/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://myhightech.org/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://myhightech.org/favicon-32x32.png>
<link rel=apple-touch-icon href=https://myhightech.org/apple-touch-icon.png>
<link rel=mask-icon href=https://myhightech.org/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<script src=/js/chart.3.3.1.min.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-44256981-9','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<meta property="og:title" content="Using AWS SAM and CodeDeploy to deploy serverless applications">
<meta property="og:description" content="AWS Serverless Application Model I was recently preparing for my AWS DevOps Engineer exam and I wanted to give AWS Serverless Application Model a try. AWS Serverless Application Model is a framework to build and deploy serverless application on AWS using Lambda, API Gateway and DynamoDB.
Under the hood it is a AWS CloudFormation transform, which expands the CloudFormation syntax and adds additional resources under the AWS::Serverless namespace. During the template provisioning those resources get expanded to basic CloudFormation resources.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://myhightech.org/posts/aws-sam-codedeploy/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-09-18T00:00:00+00:00">
<meta property="article:modified_time" content="2020-09-18T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Using AWS SAM and CodeDeploy to deploy serverless applications">
<meta name=twitter:description content="AWS Serverless Application Model I was recently preparing for my AWS DevOps Engineer exam and I wanted to give AWS Serverless Application Model a try. AWS Serverless Application Model is a framework to build and deploy serverless application on AWS using Lambda, API Gateway and DynamoDB.
Under the hood it is a AWS CloudFormation transform, which expands the CloudFormation syntax and adds additional resources under the AWS::Serverless namespace. During the template provisioning those resources get expanded to basic CloudFormation resources.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://myhightech.org/posts/"},{"@type":"ListItem","position":3,"name":"Using AWS SAM and CodeDeploy to deploy serverless applications","item":"https://myhightech.org/posts/aws-sam-codedeploy/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using AWS SAM and CodeDeploy to deploy serverless applications","name":"Using AWS SAM and CodeDeploy to deploy serverless applications","description":"AWS Serverless Application Model I was recently preparing for my AWS DevOps Engineer exam and I wanted to give AWS Serverless Application Model a try. AWS Serverless Application Model is a framework to build and deploy serverless application on AWS using Lambda, API Gateway and DynamoDB.\nUnder the hood it is a AWS CloudFormation transform, which expands the CloudFormation syntax and adds additional resources under the AWS::Serverless namespace. During the template provisioning those resources get expanded to basic CloudFormation resources.","keywords":["aws","serverless","lambda","devops","codedeploy","serverless application model","sam"],"articleBody":"AWS Serverless Application Model I was recently preparing for my AWS DevOps Engineer exam and I wanted to give AWS Serverless Application Model a try. AWS Serverless Application Model is a framework to build and deploy serverless application on AWS using Lambda, API Gateway and DynamoDB.\nUnder the hood it is a AWS CloudFormation transform, which expands the CloudFormation syntax and adds additional resources under the AWS::Serverless namespace. During the template provisioning those resources get expanded to basic CloudFormation resources.\nThe sam CLI has commands to build, test, package and deploy your serverless applications. It makes deploying serverless application much easier than packaging your application by yourself and using generic CloudFormation templates.\nInitialize the project To initialize the project you use the sam init command. It will ask a few questions and prepare a boilerplate project.\n$ sam init Which template source would you like to use? 1 - AWS Quick Start Templates 2 - Custom Template Location Choice: 1 Which runtime would you like to use? 1 - nodejs12.x 2 - python3.8 3 - ruby2.7 4 - go1.x 5 - java11 6 - dotnetcore3.1 7 - nodejs10.x 8 - python3.7 9 - python3.6 10 - python2.7 11 - ruby2.5 12 - java8.al2 13 - java8 14 - dotnetcore2.1 Runtime: 4 Project name [sam-app]: Cloning app templates from https://github.com/awslabs/aws-sam-cli-app-templates.git AWS quick start application templates: 1 - Hello World Example 2 - Step Functions Sample App (Stock Trader) Template selection: 1 ----------------------- Generating application: ----------------------- Name: sam-app Runtime: go1.x Dependency Manager: mod Application Template: hello-world Output Directory: . Next steps can be found in the README file at ./sam-app/README.md $ tree . ├── Makefile ├── README.md ├── hello-world │ ├── go.mod │ ├── main.go │ └── main_test.go └── template.yaml 1 directory, 6 files The project has a CloudFormation template in template.yaml and an example Lambda function handler in hello-world/main.go. You can notice the Transform: AWS::Serverless-2016-10-31 field in the template, which means we are using AWS SAM:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  AWSTemplateFormatVersion: '2010-09-09' Transform: AWS::Serverless-2016-10-31  [...] Resources: HelloWorldFunction: Type: AWS::Serverless::Function Properties: CodeUri: hello-world/ Handler: hello-world Runtime: go1.x Tracing: Active Events: CatchAll: Type: Api Properties: Path: /hello Method: GET Environment: Variables: PARAM1: VALUE [...]   Local development Now to build the Lambda deployment packages run sam build.\n$ sam build Building function 'HelloWorldFunction' Running GoModulesBuilder:Build Build Succeeded Built Artifacts : .aws-sam/build Built Template : .aws-sam/build/template.yaml Commands you can use next ========================= [*] Invoke Function: sam local invoke [*] Deploy: sam deploy --guided A nice feature of SAM CLI is that you can run the Lambda function locally or even run a server, which simulates whole API in the template. For this you will need to have Docker installed.\nTo invoke a single function use sam local invoke : $ sam local invoke HelloWorldFunction Invoking hello-world (go1.x) Failed to download a new amazon/aws-sam-cli-emulation-image-go1.x:rapid-1.1.0 image. Invoking with the already downloaded image. Mounting /home/damian/Projects/sam-test/sam-app/.aws-sam/build/HelloWorldFunction as /var/task:ro,delegated inside runtime container START RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb Version: $LATEST END RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb REPORT RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb Init Duration: 49.63 ms Duration: 549.73 ms Billed Duration: 600 ms Memory Size: 128 MB Max Memory Used: 51 MB {\"statusCode\":200,\"headers\":null,\"multiValueHeaders\":null,\"body\":\"Hello, 178.43.131.97\\n\"}\nYou can also start a server, which simulates the AWS API Gateway: $ sam local start-api Mounting HelloWorldFunction at http://127.0.0.1:3000/hello [GET] You can now browse to the above endpoints to invoke your functions. You do not need to restart/reload SAM CLI while working on your functions, changes will be reflected instantly/automatically. You only need to restart SAM CLI if you update your AWS SAM template 2020-09-17 17:54:42 * Running on http://127.0.0.1:3000/ (Press CTRL+C to quit) # in other terminal $ curl http://127.0.0.1:3000/hello Hello, 178.43.131.97\nDeploy the application To deploy Lambda functions you need to package and upload your code to S3. AWS SAM will handle this for you, but it requires an additonal configuration file samconfig.toml to know what bucket it should use.\n1 2 3 4 5 6 7 8 9 10 11  # samconfig.toml version = 0.1 [default] [default.deploy] [default.deploy.parameters] stack_name = \"sam-app\" s3_bucket = \"aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy\" s3_prefix = \"sam-app\" region = \"eu-west-1\" confirm_changeset = true capabilities = \"CAPABILITY_IAM\"   You can either provision the S3 bucket and create the samconfig.toml file manually or use the --guided flag in the sam deploy command, so SAM will create it for you.\nWhat sam deploy does is:\n Detect, which functions must be updated Upload the CloudFormation template and Lambda deployment packages to S3 Generate the ChangeSet and deploy it  $ sam deploy --guided Configuring SAM deploy ====================== Looking for samconfig.toml : Not found Setting default arguments for 'sam deploy' ========================================= Stack Name [sam-app]: AWS Region [us-east-1]: eu-west-1 #Shows you resources changes to be deployed and require a 'Y' to initiate deploy Confirm changes before deploy [y/N]: y #SAM needs permission to be able to create roles to connect to the resources in your template Allow SAM CLI IAM role creation [Y/n]: Y HelloWorldFunction may not have authorization defined, Is this okay? [y/N]: y Save arguments to samconfig.toml [Y/n]: Looking for resources needed for deployment: Not found. Creating the required resources... Successfully created! Managed S3 bucket: aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy A different default S3 bucket can be set in samconfig.toml Saved arguments to config file Running 'sam deploy' for future deployments will use the parameters saved above. The above parameters can be changed by modifying samconfig.toml Learn more about samconfig.toml syntax at https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-config.html Uploading to sam-app/4a708650ed51c1f21e152bcc6440cf00 1325 / 1325.0 (100.00%) Deploying with following values =============================== Stack name : sam-app Region : eu-west-1 Confirm changeset : True Deployment s3 bucket : aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy Capabilities : [\"CAPABILITY_IAM\"] Parameter overrides : {} Initiating deployment ===================== HelloWorldFunction may not have authorization defined. Uploading to sam-app/cbc7be7eaba81f76b3cd7e012f847498.template 1155 / 1155.0 (100.00%) Waiting for changeset to be created.. CloudFormation stack changeset --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Operation LogicalResourceId ResourceType --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- + Add HelloWorldFunctionCatchAllPermissionProd AWS::Lambda::Permission + Add HelloWorldFunctionRole AWS::IAM::Role + Add HelloWorldFunction AWS::Lambda::Function + Add ServerlessRestApiDeployment47fc2d5f9d AWS::ApiGateway::Deployment + Add ServerlessRestApiProdStage AWS::ApiGateway::Stage + Add ServerlessRestApi AWS::ApiGateway::RestApi --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Changeset created successfully. arn:aws:cloudformation:eu-west-1:146986152083:changeSet/samcli-deploy1600354796/6dc83be8-7e11-48c9-b6b0-8df847a66ac8 Previewing CloudFormation changeset before deployment ====================================================== Deploy this changeset? [y/N]: y 2020-09-17 17:00:07 - Waiting for stack create/update to complete CloudFormation events from changeset ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ResourceStatus ResourceType LogicalResourceId ResourceStatusReason ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- CREATE_IN_PROGRESS AWS::IAM::Role HelloWorldFunctionRole - CREATE_IN_PROGRESS AWS::IAM::Role HelloWorldFunctionRole Resource creation Initiated CREATE_COMPLETE AWS::IAM::Role HelloWorldFunctionRole - CREATE_IN_PROGRESS AWS::Lambda::Function HelloWorldFunction - CREATE_COMPLETE AWS::Lambda::Function HelloWorldFunction - CREATE_IN_PROGRESS AWS::Lambda::Function HelloWorldFunction Resource creation Initiated CREATE_IN_PROGRESS AWS::ApiGateway::RestApi ServerlessRestApi - CREATE_COMPLETE AWS::ApiGateway::RestApi ServerlessRestApi - CREATE_IN_PROGRESS AWS::ApiGateway::RestApi ServerlessRestApi Resource creation Initiated CREATE_IN_PROGRESS AWS::ApiGateway::Deployment ServerlessRestApiDeployment47fc2d5f9d - CREATE_IN_PROGRESS AWS::Lambda::Permission HelloWorldFunctionCatchAllPermissionProd Resource creation Initiated CREATE_IN_PROGRESS AWS::Lambda::Permission HelloWorldFunctionCatchAllPermissionProd - CREATE_COMPLETE AWS::ApiGateway::Deployment ServerlessRestApiDeployment47fc2d5f9d - CREATE_IN_PROGRESS AWS::ApiGateway::Deployment ServerlessRestApiDeployment47fc2d5f9d Resource creation Initiated CREATE_IN_PROGRESS AWS::ApiGateway::Stage ServerlessRestApiProdStage - CREATE_IN_PROGRESS AWS::ApiGateway::Stage ServerlessRestApiProdStage Resource creation Initiated CREATE_COMPLETE AWS::ApiGateway::Stage ServerlessRestApiProdStage - CREATE_COMPLETE AWS::Lambda::Permission HelloWorldFunctionCatchAllPermissionProd - CREATE_COMPLETE AWS::CloudFormation::Stack sam-app - ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- CloudFormation outputs from deployed stack --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Outputs --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Key HelloWorldFunctionIamRole Description Implicit IAM Role created for Hello World function Value arn:aws:iam::146986152083:role/sam-app-HelloWorldFunctionRole-URQ6NEJVAE9X Key HelloWorldAPI Description API Gateway endpoint URL for Prod environment for First Function Value https://xzv8lq1611.execute-api.eu-west-1.amazonaws.com/Prod/hello/ Key HelloWorldFunction Description First Lambda Function ARN Value arn:aws:lambda:eu-west-1:146986152083:function:sam-app-HelloWorldFunction-DMK403RR7HEW --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- Successfully created/updated stack - sam-app in eu-west-1  SAM created the following CloudFormation stacks. aws-sam-cli-managed-default stack was created, because we used --guided and SAM provisioned the missing S3 bucket. sam-app stack is the actual serverless application\n   The AWS::Serverless::* resources were transformed into other CloudFormation resources. SAM also implicitly created an API Gateway for us\n  Enhance the template and add canary deployment The nice thing in AWS SAM is, that it’s just an extension of CloudFormation templates, so you can define other resources, export output values or reference values in other stacks. It also gives an option to define the deployment strategy for Lambda functions and set triggers for rollbacks. You can perform canary deployment on the AWS Lambda level by using Lambda aliases. Let’s change the HelloWorld function, add DeploymentPreference and AutoPublishAlias parameters and define all CloudWatch alarm to rollback the deployment in case your function does not work during the CodeDeploy AllowTraffic phase.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  # template.yaml [...] Resources: HelloWorldServerErrorAlarm: Type: AWS::CloudWatch::Alarm Properties: AlarmName: HelloWorldServerErrorAlarm EvaluationPeriods: 1 Metrics: - Id: m1 MetricStat: Metric: Dimensions: - Name: FunctionName Value: !Ref HelloWorldFunction MetricName: Errors Namespace: AWS/Lambda Period: !!int 60 Stat: Average ComparisonOperator: GreaterThanThreshold Threshold: 0.05 TreatMissingData: notBreaching HelloWorldFunction: Type: AWS::Serverless::Function Properties: CodeUri: hello-world/ Handler: hello-world Runtime: go1.x Tracing: Active AutoPublishAlias: live DeploymentPreference: Type: Canary10Percent5Minutes Alarms: - !Ref HelloWorldServerErrorAlarm Events: CatchAll: Type: Api Properties: Path: /hello Method: GET [...]    After defining DeploymentPreference SAM creates an CodeDeploy application with a deployment group for every Lambda function. sam deploy will upload the Lambda deployment packages to S3 and trigger an CodeDeploy deployment to release the new Lambda function version\n  Now, let’s make a small change in the source code, rebuild the package and deploy it. This can take a bit, cause the command waits, till the CodeDeploy deployment is finished:\n$ sam build ... $ sam deploy ... Successfully created/updated stack - sam-app in eu-west-1  During the sam deploy a CodeDeploy deployment is triggered\n   CodeDeploy performs the canary release using an Lambda alias. Here we can see, that 10% of the requests are directed to the 4 version of the Lambda, while the rest goes to version 3\n  More advanced example A more advanced example is available on my Github aws-dev-ops-preparation repo. It shows also how to use and implement an lifecycle hook function to validate the deployment.\nAdditional notes about SAM A few things I would like to mention, because I lost a few hours by not knowing them:\n Hook functions must start with prefix CodeDeployHook_ or you have to provide an custom IAM role for the CodeDeploy in DeploymentPreference The hook functions must call the AWS API codedeploy:PutLifecycleEventHookExecutionStatus to inform CodeDeploy, if the hook passed or failed. In other case it will wait for 1 hour and fail The Alarms in DeploymentPreference can be used to rollback the deployment on Cloudwatch Alarm. The AWS docs suggest the other way - that they are triggered by a failed deployment  Read more  AWS SAM documentation AWS SAM CloudFormation resources specification AWS CodeDeploy documentation AWS Lambda aliases  ","wordCount":"1702","inLanguage":"en","datePublished":"2020-09-18T00:00:00Z","dateModified":"2020-09-18T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://myhightech.org/posts/aws-sam-codedeploy/"},"publisher":{"@type":"Organization","name":"myhightech.org","logo":{"@type":"ImageObject","url":"https://myhightech.org/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://myhightech.org accesskey=h title="myhightech.org (Alt + H)">myhightech.org</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu onscroll=menu_on_scroll()>
<li>
<a href=https://myhightech.org/posts/ title=Blog>
<span>Blog</span>
</a>
</li>
<li>
<a href=https://myhightech.org/categories/ title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://myhightech.org/search title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://myhightech.org/about/ title="About me">
<span>About me</span>
</a>
</li></ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Using AWS SAM and CodeDeploy to deploy serverless applications
</h1>
<div class=post-meta>September 18, 2020&nbsp;·&nbsp;8 min
</div>
</header>
<div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<div class=details>Table of Contents</div>
</summary>
<div class=inner><ul><li>
<a href=#aws-serverless-application-model aria-label="AWS Serverless Application Model">AWS Serverless Application Model</a></li><li>
<a href=#initialize-the-project aria-label="Initialize the project">Initialize the project</a></li><li>
<a href=#local-development aria-label="Local development">Local development</a></li><li>
<a href=#deploy-the-application aria-label="Deploy the application">Deploy the application</a></li><li>
<a href=#enhance-the-template-and-add-canary-deployment aria-label="Enhance the template and add canary deployment">Enhance the template and add canary deployment</a></li><li>
<a href=#more-advanced-example aria-label="More advanced example">More advanced example</a></li><li>
<a href=#additional-notes-about-sam aria-label="Additional notes about SAM">Additional notes about SAM</a></li><li>
<a href=#read-more aria-label="Read more">Read more</a></li></ul>
</div>
</details>
</div>
<div class=post-content>
<h2 id=aws-serverless-application-model>AWS Serverless Application Model<a hidden class=anchor aria-hidden=true href=#aws-serverless-application-model>#</a></h2>
<p>I was recently preparing for my AWS DevOps Engineer exam and I wanted to give AWS Serverless Application Model a try. AWS Serverless Application Model is a framework to build and deploy serverless application on AWS using Lambda, API Gateway and DynamoDB.</p>
<p>Under the hood it is a AWS CloudFormation transform, which expands the CloudFormation syntax and adds additional resources under the <code>AWS::Serverless</code> namespace. During the template provisioning those resources get expanded to basic CloudFormation resources.</p>
<p>The <code>sam</code> CLI has commands to build, test, package and deploy your serverless applications. It makes deploying serverless application much easier than packaging your application by yourself and using generic CloudFormation templates.</p>
<h2 id=initialize-the-project>Initialize the project<a hidden class=anchor aria-hidden=true href=#initialize-the-project>#</a></h2>
<p>To initialize the project you use the <code>sam init</code> command. It will ask a few questions and prepare a boilerplate project.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>$ sam init 
Which template source would you like to use?
        <span style=color:#ae81ff>1</span> - AWS Quick Start Templates
        <span style=color:#ae81ff>2</span> - Custom Template Location
Choice: <span style=color:#ae81ff>1</span>

Which runtime would you like to use?
        <span style=color:#ae81ff>1</span> - nodejs12.x
        <span style=color:#ae81ff>2</span> - python3.8
        <span style=color:#ae81ff>3</span> - ruby2.7
        <span style=color:#ae81ff>4</span> - go1.x
        <span style=color:#ae81ff>5</span> - java11
        <span style=color:#ae81ff>6</span> - dotnetcore3.1
        <span style=color:#ae81ff>7</span> - nodejs10.x
        <span style=color:#ae81ff>8</span> - python3.7
        <span style=color:#ae81ff>9</span> - python3.6
        <span style=color:#ae81ff>10</span> - python2.7
        <span style=color:#ae81ff>11</span> - ruby2.5
        <span style=color:#ae81ff>12</span> - java8.al2
        <span style=color:#ae81ff>13</span> - java8
        <span style=color:#ae81ff>14</span> - dotnetcore2.1
Runtime: <span style=color:#ae81ff>4</span>

Project name <span style=color:#f92672>[</span>sam-app<span style=color:#f92672>]</span>: 

Cloning app templates from https://github.com/awslabs/aws-sam-cli-app-templates.git

AWS quick start application templates:
        <span style=color:#ae81ff>1</span> - Hello World Example
        <span style=color:#ae81ff>2</span> - Step Functions Sample App <span style=color:#f92672>(</span>Stock Trader<span style=color:#f92672>)</span>
Template selection: <span style=color:#ae81ff>1</span>

-----------------------
Generating application:
-----------------------
Name: sam-app
Runtime: go1.x
Dependency Manager: mod
Application Template: hello-world
Output Directory: .

Next steps can be found in the README file at ./sam-app/README.md
$ tree
.
├── Makefile
├── README.md
├── hello-world
│   ├── go.mod
│   ├── main.go
│   └── main_test.go
└── template.yaml

<span style=color:#ae81ff>1</span> directory, <span style=color:#ae81ff>6</span> files</code></pre></div>
<p>The project has a CloudFormation template in <code>template.yaml</code> and an example Lambda function handler in <code>hello-world/main.go</code>. You can notice the <code>Transform: AWS::Serverless-2016-10-31</code> field in the template, which means we are using AWS SAM:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style=display:block;width:100%;background-color:#3c3d38><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#f92672>AWSTemplateFormatVersion</span>: <span style=color:#e6db74>&#39;2010-09-09&#39;</span>
<span style=display:block;width:100%;background-color:#3c3d38><span style=color:#f92672>Transform</span>: <span style=color:#ae81ff>AWS::Serverless-2016-10-31</span>
</span>
[<span style=color:#ae81ff>...]</span>

<span style=color:#f92672>Resources</span>:
  <span style=color:#f92672>HelloWorldFunction</span>:
    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Serverless::Function</span>
    <span style=color:#f92672>Properties</span>:
      <span style=color:#f92672>CodeUri</span>: <span style=color:#ae81ff>hello-world/</span>
      <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>hello-world</span>
      <span style=color:#f92672>Runtime</span>: <span style=color:#ae81ff>go1.x</span>
      <span style=color:#f92672>Tracing</span>: <span style=color:#ae81ff>Active</span>
      <span style=color:#f92672>Events</span>:
        <span style=color:#f92672>CatchAll</span>:
          <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>Api</span>
          <span style=color:#f92672>Properties</span>:
            <span style=color:#f92672>Path</span>: <span style=color:#ae81ff>/hello</span>
            <span style=color:#f92672>Method</span>: <span style=color:#ae81ff>GET</span>
      <span style=color:#f92672>Environment</span>:
        <span style=color:#f92672>Variables</span>:
          <span style=color:#f92672>PARAM1</span>: <span style=color:#ae81ff>VALUE</span>

[<span style=color:#ae81ff>...]</span></code></pre></td></tr></table>
</div>
</div>
<h2 id=local-development>Local development<a hidden class=anchor aria-hidden=true href=#local-development>#</a></h2>
<p>Now to build the Lambda deployment packages run <code>sam build</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>$ sam build 
Building <span style=color:#66d9ef>function</span> <span style=color:#e6db74>&#39;HelloWorldFunction&#39;</span>
Running GoModulesBuilder:Build

Build Succeeded

Built Artifacts  : .aws-sam/build
Built Template   : .aws-sam/build/template.yaml

Commands you can use next
<span style=color:#f92672>=========================</span>
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Invoke Function: sam local invoke
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Deploy: sam deploy --guided</code></pre></div>
<p>A nice feature of SAM CLI is that you can run the Lambda function locally or even run a server, which simulates whole API in the template. For this you will need to have Docker installed.</p>
<p>To invoke a single function use <code>sam local invoke &lt;function-name></code>:
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>$ sam local invoke HelloWorldFunction
Invoking hello-world <span style=color:#f92672>(</span>go1.x<span style=color:#f92672>)</span>
Failed to download a new amazon/aws-sam-cli-emulation-image-go1.x:rapid-1.1.0 image. Invoking with the already downloaded image.
Mounting /home/damian/Projects/sam-test/sam-app/.aws-sam/build/HelloWorldFunction as /var/task:ro,delegated inside runtime container
START RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb Version: $LATEST
END RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb
REPORT RequestId: 861e0e67-1567-104f-55ba-5ee5b7c63eeb  Init Duration: 49.63 ms Duration: 549.73 ms     Billed Duration: <span style=color:#ae81ff>600</span> ms Memory Size: <span style=color:#ae81ff>128</span> MB     Max Memory Used: <span style=color:#ae81ff>51</span> MB

<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;statusCode&#34;</span>:200,<span style=color:#e6db74>&#34;headers&#34;</span>:null,<span style=color:#e6db74>&#34;multiValueHeaders&#34;</span>:null,<span style=color:#e6db74>&#34;body&#34;</span>:<span style=color:#e6db74>&#34;Hello, 178.43.131.97\n&#34;</span><span style=color:#f92672>}</span></code></pre></div></p>
<p>You can also start a server, which simulates the AWS API Gateway:
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>$ sam local start-api                
Mounting HelloWorldFunction at http://127.0.0.1:3000/hello <span style=color:#f92672>[</span>GET<span style=color:#f92672>]</span>
You can now browse to the above endpoints to invoke your functions. You <span style=color:#66d9ef>do</span> not need to restart/reload SAM CLI <span style=color:#66d9ef>while</span> working on your functions, changes will be reflected instantly/automatically. You only need to restart SAM CLI <span style=color:#66d9ef>if</span> you update your AWS SAM template
2020-09-17 17:54:42  * Running on http://127.0.0.1:3000/ <span style=color:#f92672>(</span>Press CTRL+C to quit<span style=color:#f92672>)</span>

<span style=color:#75715e># in other terminal</span>
$ curl http://127.0.0.1:3000/hello                                      
Hello, 178.43.131.97</code></pre></div></p>
<h2 id=deploy-the-application>Deploy the application<a hidden class=anchor aria-hidden=true href=#deploy-the-application>#</a></h2>
<p>To deploy Lambda functions you need to package and upload your code to S3. AWS SAM will handle this for you, but it requires an additonal configuration file <code>samconfig.toml</code> to know what bucket it should use.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-toml data-lang=toml><span style=color:#75715e># samconfig.toml</span>
<span style=color:#a6e22e>version</span> = <span style=color:#ae81ff>0.1</span>
[<span style=color:#a6e22e>default</span>]
[<span style=color:#a6e22e>default</span>.<span style=color:#a6e22e>deploy</span>]
[<span style=color:#a6e22e>default</span>.<span style=color:#a6e22e>deploy</span>.<span style=color:#a6e22e>parameters</span>]
<span style=color:#a6e22e>stack_name</span> = <span style=color:#e6db74>&#34;sam-app&#34;</span>
<span style=color:#a6e22e>s3_bucket</span> = <span style=color:#e6db74>&#34;aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy&#34;</span>
<span style=color:#a6e22e>s3_prefix</span> = <span style=color:#e6db74>&#34;sam-app&#34;</span>
<span style=color:#a6e22e>region</span> = <span style=color:#e6db74>&#34;eu-west-1&#34;</span>
<span style=color:#a6e22e>confirm_changeset</span> = <span style=color:#66d9ef>true</span>
<span style=color:#a6e22e>capabilities</span> = <span style=color:#e6db74>&#34;CAPABILITY_IAM&#34;</span></code></pre></td></tr></table>
</div>
</div>
<p>You can either provision the S3 bucket and create the <code>samconfig.toml</code> file manually or use the <code>--guided</code> flag in the <code>sam deploy</code> command, so SAM will create it for you.</p>
<p>What <code>sam deploy</code> does is:</p>
<ol>
<li>Detect, which functions must be updated</li>
<li>Upload the CloudFormation template and Lambda deployment packages to S3</li>
<li>Generate the ChangeSet and deploy it</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>$ sam deploy --guided

Configuring SAM deploy
<span style=color:#f92672>======================</span>

        Looking <span style=color:#66d9ef>for</span> samconfig.toml :  Not found

        Setting default arguments <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#39;sam deploy&#39;</span>
        <span style=color:#f92672>=========================================</span>
        Stack Name <span style=color:#f92672>[</span>sam-app<span style=color:#f92672>]</span>: 
        AWS Region <span style=color:#f92672>[</span>us-east-1<span style=color:#f92672>]</span>: eu-west-1
        <span style=color:#75715e>#Shows you resources changes to be deployed and require a &#39;Y&#39; to initiate deploy</span>
        Confirm changes before deploy <span style=color:#f92672>[</span>y/N<span style=color:#f92672>]</span>: y
        <span style=color:#75715e>#SAM needs permission to be able to create roles to connect to the resources in your template</span>
        Allow SAM CLI IAM role creation <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span>: Y
        HelloWorldFunction may not have authorization defined, Is this okay? <span style=color:#f92672>[</span>y/N<span style=color:#f92672>]</span>: y
        Save arguments to samconfig.toml <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span>: 

        Looking <span style=color:#66d9ef>for</span> resources needed <span style=color:#66d9ef>for</span> deployment: Not found.
        Creating the required resources...
        Successfully created!

                Managed S3 bucket: aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy
                A different default S3 bucket can be set in samconfig.toml

        Saved arguments to config file
        Running <span style=color:#e6db74>&#39;sam deploy&#39;</span> <span style=color:#66d9ef>for</span> future deployments will use the parameters saved above.
        The above parameters can be changed by modifying samconfig.toml
        Learn more about samconfig.toml syntax at 
        https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-config.html
Uploading to sam-app/4a708650ed51c1f21e152bcc6440cf00  <span style=color:#ae81ff>1325</span> / 1325.0  <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span>

        Deploying with following values
        <span style=color:#f92672>===============================</span>
        Stack name                 : sam-app
        Region                     : eu-west-1
        Confirm changeset          : True
        Deployment s3 bucket       : aws-sam-cli-managed-default-samclisourcebucket-128t3n8a6nlhy
        Capabilities               : <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;CAPABILITY_IAM&#34;</span><span style=color:#f92672>]</span>
        Parameter overrides        : <span style=color:#f92672>{}</span>

Initiating deployment
<span style=color:#f92672>=====================</span>
HelloWorldFunction may not have authorization defined.
Uploading to sam-app/cbc7be7eaba81f76b3cd7e012f847498.template  <span style=color:#ae81ff>1155</span> / 1155.0  <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span>

Waiting <span style=color:#66d9ef>for</span> changeset to be created..

CloudFormation stack changeset
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Operation                                                         LogicalResourceId                                                 ResourceType                                                    
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
+ Add                                                             HelloWorldFunctionCatchAllPermissionProd                          AWS::Lambda::Permission                                         
+ Add                                                             HelloWorldFunctionRole                                            AWS::IAM::Role                                                  
+ Add                                                             HelloWorldFunction                                                AWS::Lambda::Function                                           
+ Add                                                             ServerlessRestApiDeployment47fc2d5f9d                             AWS::ApiGateway::Deployment                                     
+ Add                                                             ServerlessRestApiProdStage                                        AWS::ApiGateway::Stage                                          
+ Add                                                             ServerlessRestApi                                                 AWS::ApiGateway::RestApi                                        
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Changeset created successfully. arn:aws:cloudformation:eu-west-1:146986152083:changeSet/samcli-deploy1600354796/6dc83be8-7e11-48c9-b6b0-8df847a66ac8


Previewing CloudFormation changeset before deployment
<span style=color:#f92672>======================================================</span>
Deploy this changeset? <span style=color:#f92672>[</span>y/N<span style=color:#f92672>]</span>: y

2020-09-17 17:00:07 - Waiting <span style=color:#66d9ef>for</span> stack create/update to complete

CloudFormation events from changeset
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ResourceStatus                                   ResourceType                                     LogicalResourceId                                ResourceStatusReason                           
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE_IN_PROGRESS                               AWS::IAM::Role                                   HelloWorldFunctionRole                           -                                              
CREATE_IN_PROGRESS                               AWS::IAM::Role                                   HelloWorldFunctionRole                           Resource creation Initiated                    
CREATE_COMPLETE                                  AWS::IAM::Role                                   HelloWorldFunctionRole                           -                                              
CREATE_IN_PROGRESS                               AWS::Lambda::Function                            HelloWorldFunction                               -                                              
CREATE_COMPLETE                                  AWS::Lambda::Function                            HelloWorldFunction                               -                                              
CREATE_IN_PROGRESS                               AWS::Lambda::Function                            HelloWorldFunction                               Resource creation Initiated                    
CREATE_IN_PROGRESS                               AWS::ApiGateway::RestApi                         ServerlessRestApi                                -                                              
CREATE_COMPLETE                                  AWS::ApiGateway::RestApi                         ServerlessRestApi                                -                                              
CREATE_IN_PROGRESS                               AWS::ApiGateway::RestApi                         ServerlessRestApi                                Resource creation Initiated                    
CREATE_IN_PROGRESS                               AWS::ApiGateway::Deployment                      ServerlessRestApiDeployment47fc2d5f9d            -                                              
CREATE_IN_PROGRESS                               AWS::Lambda::Permission                          HelloWorldFunctionCatchAllPermissionProd         Resource creation Initiated                    
CREATE_IN_PROGRESS                               AWS::Lambda::Permission                          HelloWorldFunctionCatchAllPermissionProd         -                                              
CREATE_COMPLETE                                  AWS::ApiGateway::Deployment                      ServerlessRestApiDeployment47fc2d5f9d            -                                              
CREATE_IN_PROGRESS                               AWS::ApiGateway::Deployment                      ServerlessRestApiDeployment47fc2d5f9d            Resource creation Initiated                    
CREATE_IN_PROGRESS                               AWS::ApiGateway::Stage                           ServerlessRestApiProdStage                       -                                              
CREATE_IN_PROGRESS                               AWS::ApiGateway::Stage                           ServerlessRestApiProdStage                       Resource creation Initiated                    
CREATE_COMPLETE                                  AWS::ApiGateway::Stage                           ServerlessRestApiProdStage                       -                                              
CREATE_COMPLETE                                  AWS::Lambda::Permission                          HelloWorldFunctionCatchAllPermissionProd         -                                              
CREATE_COMPLETE                                  AWS::CloudFormation::Stack                       sam-app                                          -                                              
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CloudFormation outputs from deployed stack
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Outputs                                                                                                                                                                                           
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Key                 HelloWorldFunctionIamRole                                                                                                                                                     
Description         Implicit IAM Role created <span style=color:#66d9ef>for</span> Hello World <span style=color:#66d9ef>function</span>                                                                                                                            
Value               arn:aws:iam::146986152083:role/sam-app-HelloWorldFunctionRole-URQ6NEJVAE9X                                                                                                    

Key                 HelloWorldAPI                                                                                                                                                                 
Description         API Gateway endpoint URL <span style=color:#66d9ef>for</span> Prod environment <span style=color:#66d9ef>for</span> First Function                                                                                                              
Value               https://xzv8lq1611.execute-api.eu-west-1.amazonaws.com/Prod/hello/                                                                                                            

Key                 HelloWorldFunction                                                                                                                                                            
Description         First Lambda Function ARN                                                                                                                                                     
Value               arn:aws:lambda:eu-west-1:146986152083:function:sam-app-HelloWorldFunction-DMK403RR7HEW                                                                                        
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Successfully created/updated stack - sam-app in eu-west-1</code></pre></div>
<figure><a href=/images/aws-sam-codedeploy/aws_sam_cf_stacks.png target=_blank>
<img loading=lazy src=/images/aws-sam-codedeploy/aws_sam_cf_stacks.png alt="SAM created the following CloudFormation stacks. aws-sam-cli-managed-default stack was created, because we used --guided and SAM provisioned the missing S3 bucket. sam-app stack is the actual serverless application"> </a><figcaption>
<p>SAM created the following CloudFormation stacks. <code>aws-sam-cli-managed-default</code> stack was created, because we used <code>--guided</code> and SAM provisioned the missing S3 bucket. <code>sam-app</code> stack is the actual serverless application</p>
</figcaption>
</figure>
<figure><a href=/images/aws-sam-codedeploy/aws_sam_stack_resources.png target=_blank>
<img loading=lazy src=/images/aws-sam-codedeploy/aws_sam_stack_resources.png alt="The AWS::Serverless::* resources were transformed into other CloudFormation resources. SAM also implicitly created an API Gateway for us"> </a><figcaption>
<p>The <code>AWS::Serverless::*</code> resources were transformed into other CloudFormation resources. SAM also implicitly created an API Gateway for us</p>
</figcaption>
</figure>
<h2 id=enhance-the-template-and-add-canary-deployment>Enhance the template and add canary deployment<a hidden class=anchor aria-hidden=true href=#enhance-the-template-and-add-canary-deployment>#</a></h2>
<p>The nice thing in AWS SAM is, that it&rsquo;s just an extension of CloudFormation templates, so you can define other resources, export output values or reference values in other stacks. It also gives an option to define the deployment strategy for Lambda functions and set triggers for rollbacks. You can perform canary deployment on the AWS Lambda level by using Lambda aliases. Let&rsquo;s change the HelloWorld function, add <code>DeploymentPreference</code> and <code>AutoPublishAlias</code> parameters and define all CloudWatch alarm to rollback the deployment in case your function does not work during the CodeDeploy <code>AllowTraffic</code> phase.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=color:#75715e># template.yaml</span>
[<span style=color:#ae81ff>...]</span>
<span style=color:#f92672>Resources</span>:
  <span style=color:#f92672>HelloWorldServerErrorAlarm</span>:
    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::CloudWatch::Alarm</span>
    <span style=color:#f92672>Properties</span>:
      <span style=color:#f92672>AlarmName</span>: <span style=color:#ae81ff>HelloWorldServerErrorAlarm</span>
      <span style=color:#f92672>EvaluationPeriods</span>: <span style=color:#ae81ff>1</span>
      <span style=color:#f92672>Metrics</span>:
      - <span style=color:#f92672>Id</span>: <span style=color:#ae81ff>m1</span>
        <span style=color:#f92672>MetricStat</span>:
          <span style=color:#f92672>Metric</span>:
            <span style=color:#f92672>Dimensions</span>:
              - <span style=color:#f92672>Name</span>: <span style=color:#ae81ff>FunctionName</span>
                <span style=color:#f92672>Value</span>: !<span style=color:#ae81ff>Ref HelloWorldFunction</span>
            <span style=color:#f92672>MetricName</span>: <span style=color:#ae81ff>Errors</span>
            <span style=color:#f92672>Namespace</span>: <span style=color:#ae81ff>AWS/Lambda</span>
          <span style=color:#f92672>Period</span>: <span style=color:#75715e>!!int</span> <span style=color:#ae81ff>60</span>
          <span style=color:#f92672>Stat</span>: <span style=color:#ae81ff>Average</span>
      <span style=color:#f92672>ComparisonOperator</span>: <span style=color:#ae81ff>GreaterThanThreshold</span>
      <span style=color:#f92672>Threshold</span>: <span style=color:#ae81ff>0.05</span>
      <span style=color:#f92672>TreatMissingData</span>: <span style=color:#ae81ff>notBreaching</span>

  <span style=color:#f92672>HelloWorldFunction</span>:
    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Serverless::Function</span>
    <span style=color:#f92672>Properties</span>:
      <span style=color:#f92672>CodeUri</span>: <span style=color:#ae81ff>hello-world/</span>
      <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>hello-world</span>
      <span style=color:#f92672>Runtime</span>: <span style=color:#ae81ff>go1.x</span>
      <span style=color:#f92672>Tracing</span>: <span style=color:#ae81ff>Active</span>
      <span style=color:#f92672>AutoPublishAlias</span>: <span style=color:#ae81ff>live</span>
      <span style=color:#f92672>DeploymentPreference</span>:
        <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>Canary10Percent5Minutes</span>
        <span style=color:#f92672>Alarms</span>:
          - !<span style=color:#ae81ff>Ref HelloWorldServerErrorAlarm</span>
      <span style=color:#f92672>Events</span>:
        <span style=color:#f92672>CatchAll</span>:
          <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>Api</span>
          <span style=color:#f92672>Properties</span>:
            <span style=color:#f92672>Path</span>: <span style=color:#ae81ff>/hello</span>
            <span style=color:#f92672>Method</span>: <span style=color:#ae81ff>GET</span>
[<span style=color:#ae81ff>...]</span></code></pre></td></tr></table>
</div>
</div>
<figure><a href=/images/aws-sam-codedeploy/sam-codedeploy.png target=_blank>
<img loading=lazy src=/images/aws-sam-codedeploy/sam-codedeploy.png alt="After defining DeploymentPreference SAM creates an CodeDeploy application with a deployment group for every Lambda function. sam deploy will upload the Lambda deployment packages to S3 and trigger an CodeDeploy deployment to release the new Lambda function version"> </a><figcaption>
<p>After defining <code>DeploymentPreference</code> SAM creates an CodeDeploy application with a deployment group for every Lambda function. <code>sam deploy</code> will upload the Lambda deployment packages to S3 and trigger an CodeDeploy deployment to release the new Lambda function version</p>
</figcaption>
</figure>
<p>Now, let&rsquo;s make a small change in the source code, rebuild the package and deploy it. This can take a bit, cause the command waits, till the CodeDeploy deployment is finished:</p>
<pre tabindex=0><code>$ sam build
...
$ sam deploy
...
Successfully created/updated stack - sam-app in eu-west-1
</code></pre><figure><a href=/images/aws-sam-codedeploy/sam-codedeploy-deployment.png target=_blank>
<img loading=lazy src=/images/aws-sam-codedeploy/sam-codedeploy-deployment.png alt="During the sam deploy a CodeDeploy deployment is triggered"> </a><figcaption>
<p>During the <code>sam deploy</code> a CodeDeploy deployment is triggered</p>
</figcaption>
</figure>
<figure><a href=/images/aws-sam-codedeploy/sam-codedeploy-lambda.png target=_blank>
<img loading=lazy src=/images/aws-sam-codedeploy/sam-codedeploy-lambda.png alt="CodeDeploy performs the canary release using an Lambda alias. Here we can see, that 10% of the requests are directed to the 4 version of the Lambda, while the rest goes to version 3"> </a><figcaption>
<p>CodeDeploy performs the canary release using an Lambda alias. Here we can see, that 10% of the requests are directed to the 4 version of the Lambda, while the rest goes to version 3</p>
</figcaption>
</figure>
<h2 id=more-advanced-example>More advanced example<a hidden class=anchor aria-hidden=true href=#more-advanced-example>#</a></h2>
<p>A more advanced example is available on my Github <a href=https://github.com/Trojan295/aws-dev-ops-preparation/tree/master/lambda-sam/backend>aws-dev-ops-preparation repo</a>. It shows also how to use and implement an <a href=https://github.com/Trojan295/aws-dev-ops-preparation/blob/master/lambda-sam/backend/notes/handlers/validateApi/main.go>lifecycle hook function</a> to validate the deployment.</p>
<h2 id=additional-notes-about-sam>Additional notes about SAM<a hidden class=anchor aria-hidden=true href=#additional-notes-about-sam>#</a></h2>
<p>A few things I would like to mention, because I lost a few hours by not knowing them:</p>
<ul>
<li>Hook functions must start with prefix <code>CodeDeployHook_</code> or you have to provide an custom IAM role for the CodeDeploy in DeploymentPreference</li>
<li>The hook functions must call the AWS API <code>codedeploy:PutLifecycleEventHookExecutionStatus</code> to inform CodeDeploy, if the hook passed or failed. In other case it will wait for 1 hour and fail</li>
<li>The Alarms in DeploymentPreference can be used to rollback the deployment on Cloudwatch Alarm. The AWS docs suggest the other way - that they are triggered by a failed deployment</li>
</ul>
<h2 id=read-more>Read more<a hidden class=anchor aria-hidden=true href=#read-more>#</a></h2>
<ul>
<li><a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html>AWS SAM documentation</a></li>
<li><a href=https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-specification-resources-and-properties.html>AWS SAM CloudFormation resources specification</a></li>
<li><a href=https://docs.aws.amazon.com/codedeploy/index.html>AWS CodeDeploy documentation</a></li>
<li><a href=https://docs.aws.amazon.com/lambda/latest/dg/configuration-aliases.html>AWS Lambda aliases</a></li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://myhightech.org/tags/aws/>aws</a></li>
<li><a href=https://myhightech.org/tags/serverless/>serverless</a></li>
<li><a href=https://myhightech.org/tags/lambda/>lambda</a></li>
<li><a href=https://myhightech.org/tags/devops/>devops</a></li>
<li><a href=https://myhightech.org/tags/codedeploy/>codedeploy</a></li>
<li><a href=https://myhightech.org/tags/serverless-application-model/>serverless application model</a></li>
<li><a href=https://myhightech.org/tags/sam/>sam</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on twitter" href="https://twitter.com/intent/tweet/?text=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications&url=https%3a%2f%2fmyhightech.org%2fposts%2faws-sam-codedeploy%2f&hashtags=aws%2cserverless%2clambda%2cdevops%2ccodedeploy%2cserverlessapplicationmodel%2csam"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmyhightech.org%2fposts%2faws-sam-codedeploy%2f&title=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications&summary=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications&source=https%3a%2f%2fmyhightech.org%2fposts%2faws-sam-codedeploy%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmyhightech.org%2fposts%2faws-sam-codedeploy%2f&title=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmyhightech.org%2fposts%2faws-sam-codedeploy%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on whatsapp" href="https://api.whatsapp.com/send?text=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications%20-%20https%3a%2f%2fmyhightech.org%2fposts%2faws-sam-codedeploy%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Using AWS SAM and CodeDeploy to deploy serverless applications on telegram" href="https://telegram.me/share/url?text=Using%20AWS%20SAM%20and%20CodeDeploy%20to%20deploy%20serverless%20applications&url=https%3a%2f%2fmyhightech.org%2fposts%2faws-sam-codedeploy%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer><div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//myhightech-blog.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</article>
</main><footer class=footer>
<span>&copy; 2021 <a href=https://myhightech.org>myhightech.org</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)">
<button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</button>
</a>
<script defer src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>